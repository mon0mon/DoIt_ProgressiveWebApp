<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title></title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script src="https://unpkg.com/vuex@3"></script>
</head>

<body>
  <div id="app">
    <h1>안녕하세요!</h1>
    <com-counter msg="카운터1"></com-counter>
    <com-counter msg="카운터2"></com-counter>
  </div>
</body>

<script !src="">
  const store = new Vuex.Store({
    state: {
      count: 0
    },
    mutations: {
      fnIncData: function (state) {
        return state.count++;
      },
      fnDecData: state => state.count--
    },
    getters: {
      fnGetData(state) {
        return state.count;
      },
    },
    actions: {
      async fnDecData({
        commit}, state) {
        const result = await api.fnDecrement();
        if (result === true) commit('fnDecData')
      }
    }
  })
  
  const api = {
    fnDecrement() {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(true);
        }, 1000);
      })
    },
  };
  
  Vue.component('com-counter', {
    props:['msg'],
    template: `
      <div>
        <h2>{{msg}}</h2>
        <p>카운터 : {{fnGetCount}}</p>
        <button @click="fnIncCount">+1 증가</button>
        <button @click="fnDecCount">-1 증가(원격 API 실행)</button>
        <hr>
      </div>
    `,
    computed: {
      fnGetCount() {
        return store.getters.fnGetData;
      }
    },
    methods: {
      fnIncCount() {
        store.commit('fnIncData')
      },
      fnDecCount() {
        store.dispatch('fnDecData')
        // store.commit('fnDecData')
      }
    }
  })
  
  var gApp = new Vue({
    el: '#app',
    store
  })
</script>

</html>